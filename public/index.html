<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Keynova Lock</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
      text-align: center;
    }

    h2 {
      margin-top: 40px;
    }

    .image-picker {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .image-picker img {
      width: 90px;
      height: 90px;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
      border: 3px solid transparent;
      transition: 0.2s;
    }

    .image-picker img.selected {
      border-color: #6a0dad;
      transform: scale(1.05);
    }

    .preview {
      margin-top: 10px;
      width: 200px;
      border-radius: 10px;
    }

    button {
      padding: 10px 20px;
      background: #6a0dad;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 10px;
    }

    textarea {
      width: 90%;
      height: 80px;
      margin-top: 10px;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    pre {
      background: #222;
      color: #0f0;
      padding: 15px;
      border-radius: 8px;
      text-align: left;
      direction: ltr;
      overflow-x: auto;
    }
  </style>
</head>
<body>

  <h1>ğŸ” Keynova Lock</h1>
  <p>ØµÙˆØ±Ø© + ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± = Ù…ÙØªØ§Ø­ ØºÙŠØ± Ù‚Ø§Ø¨Ù„ Ù„Ù„ÙƒØ³Ø±</p>

  <!-- Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØµÙˆØ±Ø© -->
  <h2>Ø§Ø®ØªØ± ØµÙˆØ±Ø©</h2>
  <div class="image-picker" id="imagePicker"></div>
  <img id="preview" class="preview" src="" hidden>

  <input id="password" type="text" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

  <br>
  <button onclick="generateKey()">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…ÙØªØ§Ø­</button>

  <h3>Ø§Ù„Ù†ØªÙŠØ¬Ø©:</h3>
  <pre id="result"></pre>

  <h2>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ÙØªØ§Ø­</h2>
  <textarea id="verifyKey" placeholder="Ø§Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ù‡Ù†Ø§"></textarea>
  <br>
  <button onclick="verifyKeyNow()">ØªØ­Ù‚Ù‚ Ø§Ù„Ø¢Ù†</button>

  <pre id="verifyResult"></pre>

<script>
  // Ø¥Ø¶Ø§ÙØ© 24 ØµÙˆØ±Ø©
  const images = [];
  for (let i = 1; i <= 24; i++) {
    images.push(`image${i}.jpeg`);
  }

  let selectedImage = null;

  // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±
  const picker = document.getElementById("imagePicker");
  images.forEach(img => {
    const el = document.createElement("img");
    el.src = "/images/" + img;
    el.onclick = () => selectImage(el, img);
    picker.appendChild(el);
  });

  function selectImage(el, img) {
    selectedImage = img;

    document.querySelectorAll(".image-picker img").forEach(i => i.classList.remove("selected"));
    el.classList.add("selected");

    const preview = document.getElementById("preview");
    preview.src = "/images/" + img;
    preview.hidden = false;
  }

  async function generateKey() {
    if (!selectedImage) return alert("Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");
    const password = document.getElementById("password").value.trim();

    if (!password) return alert("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±");

    const res = await fetch("/api/generate-key", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        imageURL: `/images/${selectedImage}`,
        password
      })
    });

    const data = await res.json();
    document.getElementById("result").textContent = JSON.stringify(data, null, 2);
  }

  async function verifyKeyNow() {
    if (!selectedImage) return alert("Ø§Ø®ØªØ± Ù†ÙØ³ Ø§Ù„ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹");

    const password = document.getElementById("password").value.trim();
    const finalKey = document.getElementById("verifyKey").value
      .trim()
      .replace(/\s+/g, "")
      .replace(/[^a-fA-F0-9]/g, "");

    if (!password || !finalKey) {
      alert("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ÙˆØ§Ù„ØµÙ‚ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ");
      return;
    }

    const res = await fetch("/api/verify-key", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({
        imageURL: `/images/${selectedImage}`,
        password,
        finalKey
      })
    });

    const data = await res.json();
    document.getElementById("verifyResult").textContent = JSON.stringify(data, null, 2);
  }
</script>

</body>
</html>
